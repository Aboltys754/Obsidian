
Тип данных `Decimal` – это класс из стандартного модуля `decimal`. Он представляет собой число с плавающей точкой, как и `float`. Однако, `Decimal` имеет ряд существенных отличий от `float`.
Тип `Decimal` создан, чтобы операции над вещественными числами в компьютере выполнялись как в математике, и равенство `0.1 + 0.1 + 0.1 == 0.3` было верным.

Тип данных `Decimal` – число с плавающей точкой с основанием экспоненты 1010. Он реализован по стандарту IBM: General Decimal Arithmetic Specification, в свою очередь основанному на стандартах IEEE.

Тип данных `Decimal` реализован программно, поэтому он в разы медленнее типа данных `float`, реализованного аппаратно. Сам тип данных `Decimal` написан на языке С.

Тип данных `Decimal` оперирует числами с произвольной – задаваемой программистом, но конечной точностью. По умолчанию точность составляет 2828 десятичных знаков.

```d
Тип данных `Decimal` неизменяемый. Операции над ним приводят к созданию новых объектов, при этом старые не меняются.
```
Для типа данных `Decimal` можно настроить:

- точность выполнения операций в количестве десятичных знаков;
- режимы округления;
- режимы обработки исключительных ситуаций (деление на ноль, переполнение и т. д).

### Создание Decimal чисел

```python
from decimal import * 
d1 = Decimal(1) 
d2 = Decimal(567) 
d3 = Decimal(-93) 
d4 = Decimal('12345') 
d5 = Decimal('52.198') 
print(d1, d2, d3, d4, d5, sep='\n')

>>>1 
>>>567 
>>>-93 
>>>12345 
>>>52.198
```

Не рекомендуется создавать `Decimal` числа из `float` чисел. В `Decimal` попадет уже неправильно округленное число. Создавать `Decimal` числа нужно из целых чисел, либо из строк!

###  Арифметические операции над Decimal числами
Тип данных `Decimal` отлично интегрирован в язык Python. С `Decimal` числами работают все привычные операции: сложение, вычитание, умножение, деление, возведение в степень.
```python
from decimal import * 
num1 = Decimal('5.2') 
num2 = Decimal('2.3') 
print(num1 + num2) 
print(num1 - num2) 
print(num1 * num2) 
print(num1 / num2) 
print(num1 // num2) 
print(num1 ** num2)
>>>7.5 
>>>2.9 
>>>11.96 
>>>2.260869565217391304347826087 
>>>2 
>>>44.34122533787992500412791298
```
Можно совершать арифметические операции над `Decimal` и целыми числами (миксовать `Decimal` и `int`), но не рекомендуется смешивать их с `float`.

### Математические функции

`Decimal` числа можно передавать как аргументы функциям, ожидающим `float`. Они будут преобразованы во `float`. К примеру, модуль `math`, оперирующий `float` числами, может работать и с `Decimal` числами
```python
from decimal import * 
from math import * 
num1 = Decimal('1.44') 
num2 = Decimal('0.523') 
print(sqrt(num1)) 
print(sin(num2)) 
print(log(num1 + num2))
```
Важно понимать, что результатом работы функции модуля `math` являются `float` числа, а не `Decimal`.

Тип данных `Decimal` содержит некоторые встроенные математические методы, возвращающие значения `Decimal`.
```python
from decimal import * 
num = Decimal('10.0') 
print(num.sqrt()) 
print(num.exp()) 
print(num.ln()) 
print(num.log10())
>>> 3.162277660168379331998893544 
>>> 22026.46579480671651695790065 
>>> 2.302585092994045684017991455 
>>> 1
```

Тип данных `Decimal` также содержит полезный метод `as_tuple()` который возвращает кортеж из 33 элементов:

- `sign` – знак числа (00 для положительного числа и 11 для отрицательного числа);
- `digits` – цифры числа;
- `exponent` – значение экспоненты (количество цифр после точки, умноженное на −1−1),
```python
from decimal import * 
num1 = Decimal('-1.4568769017') 
num2 = Decimal('0.523') 
print(num1.as_tuple()) 
print(num2.as_tuple())

>>>DecimalTuple(sign=1, digits=(1, 4, 5, 6, 8, 7, 6, 9, 0, 1, 7), exponent=-10)
>>>DecimalTuple(sign=0, digits=(5, 2, 3), exponent=-3)
```
```python
from decimal import * 
num = Decimal('-1.4568769017') 
num_tuple = num.as_tuple() 
print(num_tuple.sign) 
print(num_tuple.digits) 
print(num_tuple.exponent)

>>>1 
>>>(1, 4, 5, 6, 8, 7, 6, 9, 0, 1, 7) 
>>>-10
```

### Сравнение float и Decimal чисел
Выбор между типами данных `Decimal` и `float` – поиск компромисса в условиях конкретной задачи.

Если нужно считать очень много (симуляции, физика, графика, игры), имеет смысл отказаться от точности `Decimal` в пользу скорости и компактности хранения данных `float`. В бизнесе и финансах считать приходится не так много, но делать это нужно предельно точно, тут имеет смысл посмотреть в сторону `Decimal`.

![[Pasted image 20240501164602.png]]

### Работа с контекстом Decimal чисел
Базовые параметры `Decimal` можно посмотреть в его **контексте**, выполнив функцию `getcontext()`.
```python
from decimal import * 
print(getcontext())

>>> Context(prec=28, rounding=ROUND_HALF_EVEN, Emin=-999999, Emax=999999, capitals=1, clamp=0, flags=[], traps=[InvalidOperation, DivisionByZero, Overflow])
```
### Точность чисел
Контекстом в `Decimal` можно управлять, устанавливая свои значения. Например, чтобы управлять точностью `Decimal`, необходимо изменить параметр контекста `prec` (от англ. precision – точность). При этом точность вступает в силу только во время арифметических операций, а не при создании самих чисел.
```python
from decimal import * 
getcontext().prec = 3 # устанавливаем точность в 3 знака num = Decimal('3.1415')
print(num) 
print(num * 1) 
print(num * 2)
>>>3.1415 
>>>3.14 
>>>6.28
```
### Округление чисел
Округляют числа `Decimal` с помощью метода `quantize()`. Этот метод в качестве первого аргумента принимает объект `Decimal`, указывающий на формат округления.

```python
from decimal import * 
getcontext().prec = 4 # устанавливаем точность числа 
num = Decimal('3.1415926535') 
print(num.quantize(Decimal('1.000'))) # округление до 3 цифр в дробной части 
print(num.quantize(Decimal('1.00'))) # округление до 2 цифр в дробной части 
print(num.quantize(Decimal('1.0'))) # округление до 1 цифр в дробной части
>>> 3.142 
>>> 3.14 
>>> 3.1
```

Помимо первого параметра, метод `quantize()` принимает в качестве второго параметра стратегию округления:

- `ROUND_CEILING` – округление в направлении бесконечности (Infinity);
- `ROUND_FLOOR` – округляет в направлении минус бесконечности (- Infinity);
- `ROUND_DOWN` – округление в направлении нуля;
- `ROUND_HALF_EVEN` – округление до ближайшего четного числа, число 6.56.5 округлится не до 77, а до 66;
- `ROUND_HALF_DOWN` – округление до ближайшего нуля;
- `ROUND_UP` – округление от нуля;
- `ROUND_05UP` – округление от нуля (если последняя цифра после округления до нуля была бы 0 или 5, в противном случае к нулю).
```python
from decimal import * 
num = Decimal('3.456') 
print(num.quantize(Decimal('1.00'), ROUND_CEILING)) 
print(num.quantize(Decimal('1.00'), ROUND_FLOOR))

>>> 3.46 
>>> 3.45
```