

## Инициализация приложения

Посмотрим на простое FastAPI-приложение:

```java
from fastapi import FastAPI

app = FastAPI()
```

Класс `FastAPI` предоставляет множество параметров для настройки приложения. Эти параметры позволяют управлять поведением API, его документацией и взаимодействием с клиентами.

## Описание параметров

При создании экземпляра класса `FastAPI` вы можете настроить приложение, передав различные параметры. Начнём с параметра `debug`, который отвечает за включение режима отладки. Если установить `debug=True`, сервер будет возвращать подробные сообщения об ошибках, что удобно для разработки, но в продакшене лучше оставить значение `False`, чтобы избежать утечки чувствительной информации. Пример:

```python
from fastapi import FastAPI
app = FastAPI(debug=True)
```

Параметр `routes` позволяет задать список маршрутов для обработки HTTP- и WebSocket-запросов. Он унаследован от Starlette, но в FastAPI редко используется напрямую, так как маршруты обычно определяются через декораторы, такие как `@app.get()` или `@app.post()`. Например, вместо ручного задания маршрутов вы можете написать:

```python
from fastapi import FastAPI
app = FastAPI()
@app.get("/example")
async def example():
    return {"message": "Hello"}
```

Для улучшения документации API предусмотрен параметр `title`, который задаёт название API, отображаемое в Swagger UI и ReDoc. Например, установка `title="My First Project"` сделает ваше API более узнаваемым:

```java
from fastapi import FastAPI
app = FastAPI(title="My First Project")
```

Параметр `summary` позволяет добавить краткое описание API, которое будет отображаться в документации. Например, можно указать `summary="My CRUD application"`, чтобы кратко описать назначение API:

```java
from fastapi import FastAPI
app = FastAPI(summary="My CRUD application.")
```

Для более подробного описания используется параметр `description`, поддерживающий синтаксис Markdown (CommonMark). Это позволяет форматировать текст, например: `description="The CRUD application supports **writing**, *reading*, updating, and deleting posts."`. Такое описание сделает документацию более информативной:

```java
from fastapi import FastAPI
app = FastAPI(description="The CRUD application supports **writing**, *reading*, updating, and deleting posts.")
```

Версия вашего API задаётся через параметр `version`. Это версия вашего приложения, а не FastAPI или спецификации OpenAPI. Например, установка `version="0.0.1"` отобразит эту версию в документации:

```java
from fastapi import FastAPI
app = FastAPI(version="0.0.1")
```

Параметр `openapi_url` определяет URL, по которому доступна схема OpenAPI в формате JSON. По умолчанию это `"/openapi.json"`, но вы можете изменить путь, например, на `"/api/v1/openapi.json"`, или отключить схему, установив `None`:

```java
from fastapi import FastAPI
app = FastAPI(openapi_url="/api/v1/openapi.json")
```

Для группировки операций в документации используется параметр `openapi_tags`. Он принимает список словарей, где каждый тег описывает группу маршрутов, например, `[{"name": "users", "description": "User operations"}]`. Это помогает организовать документацию, особенно если вы используете теги в маршрутах, таких как `@app.get("/users/", tags=["users"])`:

```java
from fastapi import FastAPI
app = FastAPI(openapi_tags=[{"name": "users", "description": "User operations"}])
```

Если API работает на нескольких серверах, например, для staging и production окружений, параметр `servers`позволяет указать их адреса и описания. Например, можно задать два сервера: `[{"url": "https://stag.example.com", "description": "Staging"}, {"url": "https://prod.example.com", "description": "Production"}]`. Это удобно для тестирования API в разных окружениях:

```java
from fastapi import FastAPI
app = FastAPI(servers=[
    {"url": "https://stag.example.com", "description": "Staging"},
    {"url": "https://prod.example.com", "description": "Production"}
])
```

Формат ответов API задаётся через параметр `default_response_class`. По умолчанию используется `JSONResponse`, но для более быстрой сериализации можно выбрать, например, `ORJSONResponse`:

```javascript
from fastapi import FastAPI
from fastapi.responses import ORJSONResponse
app = FastAPI(default_response_class=ORJSONResponse)
```

Параметр `redirect_slashes` управляет автоматическим перенаправлением запросов с/без конечной косой черты. Если он включён (`True` по умолчанию), запрос к `/items` будет перенаправлен на `/items/` с кодом состояния 307:

```python
from fastapi import FastAPI
app = FastAPI(redirect_slashes=True)
@app.get("/items/")
async def read_items():
    return {"item_id": "Foo"}
```

Автоматическая документация доступна через Swagger UI и ReDoc, пути к которым задаются параметрами `docs_url` и `redoc_url`. По умолчанию они установлены как `"/docs"` и `"/redoc"`, но их можно изменить или отключить, установив `None`:

```python
from fastapi import FastAPI
app = FastAPI(docs_url="/custom-docs", redoc_url=None)
```

Для поддержки OAuth2 в Swagger UI используется параметр `swagger_ui_oauth2_redirect_url`, который задаёт путь для перенаправления при авторизации (по умолчанию `"/docs/oauth2-redirect"`). Можно указать свой путь:

```java
from fastapi import FastAPI
app = FastAPI(swagger_ui_oauth2_redirect_url="/custom-oauth-redirect")
```

Параметр `swagger_ui_init_oauth` позволяет настроить параметры OAuth2 для кнопки "Authorize" в Swagger UI, например, указав `clientId`:

```java
from fastapi import FastAPI
app = FastAPI(swagger_ui_init_oauth={"clientId": "your-client-id"})
```

Промежуточное программное обеспечение (middleware) можно добавить через параметр `middleware`, хотя в FastAPI чаще используется метод `app.add_middleware()`. Например, можно добавить middleware для логирования:

```haskell
from fastapi import FastAPI
from starlette.middleware import Middleware
from starlette.middleware.base import BaseHTTPMiddleware
class CustomMiddleware(BaseHTTPMiddleware):
    async def dispatch(self, request, call_next):
        response = await call_next(request)
        return response
app = FastAPI(middleware=[Middleware(CustomMiddleware)])
```

Обработка исключений задаётся через параметр `exception_handlers`, но обычно она настраивается через декоратор `@app.exception_handler()`. Например:

```python
from fastapi import FastAPI, HTTPException
app = FastAPI()
@app.exception_handler(HTTPException)
async def custom_exception_handler(request, exc):
    return {"detail": "Custom error"}
```

Контактная информация для API указывается через параметр `contact`, который принимает словарь с полями `name`, `url` и `email`. Это улучшает документацию, показывая, к кому обращаться:

```java
from fastapi import FastAPI
app = FastAPI(contact={
    "name": "John Doe",
    "url": "https://example.com",
    "email": "john.doe@example.com"
})
```

Информация о лицензии API задаётся через параметр `license_info`, где указываются название лицензии и её URL, например:

```java
from fastapi import FastAPI
app = FastAPI(license_info={
    "name": "MIT",
    "url": "https://opensource.org/licenses/MIT"
})
```

Условия использования API можно указать через параметр `terms_of_service`, задав URL условий, например:

```java
from fastapi import FastAPI
app = FastAPI(terms_of_service="https://example.com/terms/")
```

Если API работает за прокси, параметр `root_path` позволяет указать префикс пути, например, `"/api/v1"`. Это влияет на документацию и клиентские запросы:

```java
from fastapi import FastAPI
app = FastAPI(root_path="/api/v1")
```

Параметр `root_path_in_servers` определяет, включать ли `root_path` в список серверов в документации OpenAPI. По умолчанию он включён (`True`):

```python
from fastapi import FastAPI
app = FastAPI(root_path="/api/v1", root_path_in_servers=False)
```

## Почему это важно?

Настройка атрибутов класса `FastAPI` позволяет адаптировать приложение под конкретные требования, улучшить документацию и обеспечить удобство использования API. Параметры, такие как `title`, `description`, `contact` и `license_info`, делают документацию более информативной, а параметры, такие как `debug` и `default_response_class`, помогают в разработке и оптимизации.