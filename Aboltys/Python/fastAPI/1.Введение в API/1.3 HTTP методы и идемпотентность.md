
[[#GET]]
[[#PUT]]
[[#PATCH]]
[[#POST]]
[[#DELETE]]
[[#Идемпотентность]]


HTTP-методы — это основа взаимодействия с ресурсами в RESTful API. Они задают действия, которые клиент выполняет с определённым ресурсом. Самые распространённые методы: POST, GET, PUT и DELETE, соответствуют операциям создания, чтения, обновления и удаления данных (CRUD).

**POST:** Используется для создания нового ресурса. Клиент отправляет данные, необходимые для создания ресурса, а сервер возвращает созданный ресурс.

**GET:** Используется для получения представления ресурса. Клиент запрашивает информацию о конкретном ресурсе, а сервер возвращает данные в виде ответа.

**PUT:** Используется для обновления существующего ресурса. Клиент отправляет новые данные, и сервер обновляет ресурс с этим идентификатором.

**DELETE:** Используется для удаления ресурса. Клиент удаляет ресурс, а сервер подтверждает удаление.

|HTTP Глагол|Ожидаемый статус|Ожидаемый ответ|
|---|---|---|
|POST (создание)|201 Created|Новый URI созданного ресурса в заголовке Location|
|GET (чтение)|200 OK|Данные ресурса в теле ответа|
|PUT (обновление)|200 OK|Обновлённые данные ресурса, либо 404 Not Found, если ресурс не найден|
|DELETE (удаление)|204 No Content|Пустой ответ, не содержащий тела, показывает, что удаление прошло успешно|
|OPTIONS|200 OK|Список доступных методов HTTP в заголовке Allow|
|HEAD|200 OK|Только заголовки ответа, без тела|

Ниже разберем более подробно основные методы HTTP. 

## GET

Метод GET в REST API — один из четырёх основных методов HTTP (вместе с POST, PUT и DELETE), используемых для взаимодействия с ресурсами. Он предназначен для получения данных с сервера. GET-запрос должен быть **идемпотентным**, то есть несколько одинаковых запросов должны приводить к одному и тому же результату, без каких-либо побочных эффектов. Важно понимать, что GET-запросы не должны изменять состояние на сервере.

**Как работает GET-запрос:**

Клиент отправляет GET-запрос на определённый URI (Uniform Resource Identifier), указывающий на ресурс, который нужно получить. В запросе могут быть указаны дополнительные параметры (query parameters) для фильтрации или сортировки данных. Сервер обрабатывает запрос и возвращает представление запрошенного ресурса в теле ответа, обычно в формате JSON или XML.

**Примеры использования GET-запроса:**

- **Получение списка ресурсов:**  `/users` — возвращает список всех пользователей.
- **Получение конкретного ресурса:** `/users/123` — возвращает данные пользователя с ID 123.
- **Получение данных с фильтрацией:** `/products?category=electronics` — возвращает список продуктов из категории “электроника”.
- **Получение данных с сортировкой:** `/products?sort=price` — возвращает список продуктов, отсортированных по цене.

**Что возвращает GET-запрос:**

Успешный GET-запрос обычно возвращает HTTP-код 200 OK. В теле ответа содержится представление запрошенного ресурса. Формат представления (JSON, XML и т.д.) обычно определяется заголовком `Content-Type` в ответе.

## PUT

Метод PUT в REST API — один из четырёх основных методов HTTP (наряду с GET, POST и DELETE), используемый для обновления существующего ресурса на сервере. В отличие от метода PATCH, который позволяет частично обновлять ресурс, PUT-запрос должен полностью заменять текущее состояние ресурса новыми данными.

**Как работает PUT-запрос:**

Клиент отправляет PUT-запрос на определённый URI (Uniform Resource Identifier), указывающий на ресурс, который необходимо обновить. В теле запроса содержатся полные данные для замены существующего ресурса. Сервер обрабатывает запрос и полностью заменяет существующий ресурс новыми данными из запроса. Если ресурс с указанным URI не существует, сервер может создать новый ресурс (но это не является стандартным поведением и зависит от конкретной реализации API).

**Ключевые особенности PUT-запроса:**

- **Идемпотентность:** Повторные PUT-запросы с одинаковыми данными на один и тот же URI должны приводить к одному и тому же результату. Это означает, что состояние ресурса после первого PUT-запроса будет таким же, как и после любого последующего PUT-запроса с теми же данными.
    
- **Полная замена:** PUT-запрос полностью заменяет существующий ресурс. Он не добавляет или не удаляет отдельные атрибуты, а заменяет все данные целиком.
    
- **Уникальный URI:** PUT-запрос всегда обращается к существующему ресурсу с уникальным URI.
    

**Примеры использования PUT-запроса:**

- `/users/123`: Обновление данных пользователя с ID 123. Тело запроса содержит все данные пользователя (имя, email и т.д.).

**Возвращаемые значения:**

Успешный PUT-запрос обычно возвращает HTTP-код 200 OK (или 204 No Content, если ответ не содержит тела). Если ресурс с указанным URI не найден, сервер может вернуть HTTP-код 404 Not Found.

## PATCH

Метод PATCH в REST API — это HTTP-метод, используемый для частичного обновления ресурса на сервере. В отличие от метода PUT, который требует полной замены ресурса, PATCH позволяет изменять только определенные атрибуты существующего ресурса. Это особенно полезно, когда необходимо обновить лишь небольшую часть данных ресурса, не затрагивая другие его поля.

**Как работает PATCH-запрос:**

Клиент отправляет PATCH-запрос на URI, указывающий на ресурс, который необходимо частично обновить. В теле запроса обычно используется формат, позволяющий определить, какие изменения необходимо внедрить. Наиболее распространённый формат — JSON Patch. JSON Patch описывает изменения, которые нужно внедрить в ресурс, указываемые с помощью операторов, таких как `add`, `replace`, `remove` и т.д. Сервер обрабатывает PATCH-запрос и обновляет ресурс в соответствии с переданными изменениями.

**Ключевые особенности PATCH-запроса:**

- **Частичное обновление:** PATCH позволяет обновлять только определенные поля ресурса. Это экономит трафик и ресурс сервера, поскольку не требуется передавать все данные ресурса, если изменились только некоторые поля.
    
- **Идемпотентность (обычно):** Повторение одного и того же PATCH-запроса должно давать одинаковый результат. Однако это не всегда выполняется, и идемпотентность зависит от реализации специфичного API.
    
- **Определение изменений:** Использует формат JSON Patch, который является популярным и стандартным. JSON Patch — это набор инструкций, которые показывают, как изменить конкретные данные.
    
- **Контроль версий:** PATCH-запрос используется для незначительных изменений, что делает логи изменений более управляемыми. Важно учитывать контекст изменений и соответствующее состояние ресурса.
    

**Примеры использования PATCH-запроса:**

Предположим, у нас есть ресурс пользователя `/users/123`. Чтобы изменить только имя пользователя, мы можем использовать JSON Patch:

```json
[
  {
    "op": "replace",
    "path": "/name",
    "value": "New Name"
  }
]
```

**Возвращаемые значения:**

- **Успех:** Сервер возвращает HTTP-код 200 OK или 204 No Content, в зависимости от реализации и необходимости возврата обновлённого ресурса.
    
- **Ошибка:** Если запрос некорректен или не может быть обработан, сервер может вернуть HTTP-код 400 Bad Request или 404 Not Found.
    

## POST

Метод POST в REST API — это HTTP-метод, используемый для создания нового ресурса на сервере. В отличие от GET, который используется для получения информации, POST предназначен для отправки данных с целью создания нового ресурса на сервере. Важно понимать, что POST-запросы не должны изменять состояние ресурсов, на которые не направлены напрямую, а должны создавать новые.

**Как работает POST-запрос:**

Клиент отправляет POST-запрос на URI, который обычно идентифицирует коллекцию ресурсов, а не отдельный ресурс. В теле запроса содержатся данные, необходимые для создания нового ресурса. Сервер обрабатывает запрос, создаёт новый ресурс, и возвращает клиенту ответ с информацией о новом ресурсе. Ответ обычно включает в себя URI нового ресурса (иногда и само представление нового ресурса).

**Ключевые особенности POST-запроса:**

- **Создание нового ресурса:** POST-запросы используются для добавления новых ресурсов в систему, а не для изменения существующих.
    
- **Идемпотентность (обычно не требуется):** Повторные запросы POST с одинаковыми данными не гарантированно приводят к одному и тому же результату. Если запрос имеет побочные эффекты (например, отправка сообщения), то повторные запросы могут иметь разные последствия.
    
- **Необязательный URI в ответе:** Ответ сервера может содержать ссылку (URI) на вновь созданный ресурс, особенно в случаях создания нового ресурса в коллекции (например, в ответе может быть URI для нового пользователя).
    
- **Данные в теле запроса:** Обычно данные для создания ресурса передаются в теле запроса, например, в формате JSON. Использование query parameters для создания ресурсов не рекомендуется.
    
- **Отслеживание изменений:** POST-запрос не предназначен для обновления существующего ресурса, а только для создания нового. Обновление данных существующих ресурсов происходит с помощью PUT или PATCH.
    

**Примеры использования POST-запроса:**

- **Создание нового пользователя:** `/users` (URI коллекции пользователей). В теле запроса передаются данные нового пользователя (имя, email, пароль и т.д.). Сервер создаёт нового пользователя и возвращает в ответе URI для этого нового пользователя.
    
- **Создание нового поста:** `/posts` (URI коллекции постов). В теле запроса передаются заголовок и тело нового поста. Сервер сохраняет пост и возвращает URI для этого поста.
    

**Возвращаемые значения:**

- **Успешный запрос:** Сервер возвращает HTTP-код 201 Created, который информирует клиента о успешном создании ресурса. В заголовке `Location` может быть указан URI вновь созданного ресурса. Тело ответа может содержать дополнительную информацию о созданном ресурсе.
    
- **Ошибка:** Если запрос некорректен или сервер не может обработать запрос, сервер возвращает соответствующий HTTP-код ошибки (например, 400 Bad Request, 409 Conflict).
    

## DELETE

Метод DELETE в REST API — это HTTP-метод, используемый для удаления ресурса на сервере. Он предназначен для окончательного удаления ресурса, а не для его временного отключения или изменения состояния.

**Как работает DELETE-запрос:**

Клиент отправляет DELETE-запрос на URI, который указывает на ресурс, подлежащий удалению. Сервер обрабатывает запрос, удаляет ресурс и возвращает ответ клиенту. Важно, что ресурс, идентифицируемый URI, уничтожается.

**Ключевые особенности DELETE-запроса:**

- **Удаление ресурса:** Основная цель DELETE — удалить ресурс, а не просто изменить его статус или состояние.
    
- **Идемпотентность:** Повторные запросы DELETE на один и тот же URI с теми же параметрами должны приводить к одному и тому же результату (удалению ресурса).
    
- **Побочные эффекты:** Удаление ресурса может иметь побочные эффекты (например, удаление связанных ресурсов или обновление других записей в базе данных). Это нужно учитывать при проектировании API.
    
- **Отсутствие данных в теле запроса (обычно):** В большинстве случаев DELETE-запросы не содержат данных в теле запроса, они не передают новые данные для обновления ресурса. Параметры, необходимые для уточнения удаления, чаще всего передаются в URI или заголовках запроса.
    
- **Проверка существования ресурса:** Сервер должен проверить существование ресурса по URI перед выполнением удаления. Если ресурс не найден, сервер возвращает HTTP-код 404 (Not Found).
    

**Примеры использования DELETE-запроса:**

- **Удаление пользователя:** `/users/123` — удаляет пользователя с ID 123.
    
- **Удаление поста:** `/posts/456` — удаляет пост с ID 456.
    
- **Удаление комментария:** `/comments/789` — удаляет комментарий с ID 789.
    

**Возвращаемые значения:**

- **Успех:** Сервер возвращает HTTP-код 204 No Content, что подтверждает успешное удаление. Ответ не содержит данных в теле.
    
- **Ошибка:** Сервер может возвращать HTTP-код 404 Not Found, если ресурс не найден, 400 Bad Request, если запрос некорректен, или 409 Conflict, если удаление невозможно (например, из-за связей с другими ресурсами). В случаях, когда удаление не возможно, сервер должен пояснить причину ошибки.

## Идемпотентность

Идемпотентность в REST API — это свойство операции, которое гарантирует, что её повторное выполнение не изменит состояние системы, если результат первого выполнения был успешным. Другими словами, повторный запрос с теми же параметрами должен привести к тому же результату, что и исходный запрос. Это крайне важно для надежности и стабильности RESTful API, особенно в случаях, когда запросы могут быть отправлены несколько раз из-за временных проблем или сетевых ошибок.

**Как это работает:**

Представьте, что вы хотите выполнить операцию, скажем, забронировать билет. Идемпотентный запрос гарантирует, что, если вы отправляете запрос на бронирование один раз успешно, повторные запросы с теми же данными (теми же параметрами) не изменят состояние вашей брони. Вы не получите второй билет, а всего лишь получите подтверждение, что билет уже забронирован.

**Примеры идемпотентных операций:**

- **GET:** Получение данных ресурса — идемпотентная операция. Если вы неоднократно запросите один и тот же ресурс, результат будет одинаковым.
- **PUT (в некоторых случаях):** Обновление ресурса часто является идемпотентным. Если вы многократно отправляете PUT-запрос с одинаковыми данными, сервер установит ресурс в последнее изменённое состояние. Это идемпотентно, так как результат не меняется.
- **DELETE (в некоторых случаях):** Удаление ресурса может быть идемпотентным, если ресурса уже нет в системе. Повторное удаление того же ресурса — не изменяет состояние системы.

**Примеры НЕ идемпотентных операций:**

- **POST:** Создание нового ресурса не является идемпотентным, поскольку повторный запрос может привести к созданию дополнительных ресурсов.
- **PATCH:** Обновление ресурса частично — не всегда идемпотентная операция, так как повторные запросы могут привести к непредвиденным изменениям. Всё зависит от логики ресурса и того, как он реагирует на повторные изменения.

Использование идемпотентности — это важная часть проектирования надежных и устойчивых REST API. Это позволяет клиентам быть уверенными, что их запросы будут обработаны правильно, даже если они будут отправлены несколько раз.